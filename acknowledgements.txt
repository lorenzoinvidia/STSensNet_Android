Modifications to master branch made by Luca Vigna.
